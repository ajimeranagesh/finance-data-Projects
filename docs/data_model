select from  "FINANCE_DB"."PUBLIC"."TRANSACTIONS"
  select * from "FINANCE_DB"."PUBLIC"."FINANCE"
  select * from "FINANCE_DB"."PUBLIC"."CUSTOMERS"

  create or replace TABLE DIM_CUSTOMERS (
	CUSTOMER_KEY INT autoincrement primary key,
	CUSTOMER_ID int,
	CUSTOMER_NAME VARCHAR,
	SEGMENT VARCHAR,
	COUNTRY VARCHAR,
	SIGNUP_DATE DATE
);


insert into DIM_CUSTOMERS(
    CUSTOMER_ID ,
	CUSTOMER_NAME ,
	SEGMENT ,
	COUNTRY ,
	SIGNUP_DATE 
    )
   SELECT
    DISTINCT
    CUSTOMER_ID ,
	CUSTOMER_NAME ,
	SEGMENT ,
	COUNTRY ,
	SIGNUP_DATE 
FROM "FINANCE_DB"."PUBLIC"."CUSTOMERS"

create or replace TABLE DIM_FINANCE (
	ACCOUNT_KEY int autoincrement primary key,
	ACCOUNT_ID NUMBER,
	CUSTOMER_ID NUMBER,
	ACCOUNT_TYPE VARCHAR,
	OPEN_DATE DATE
);

insert into DIM_FINANCE (
    ACCOUNT_ID ,
	CUSTOMER_ID ,
	ACCOUNT_TYPE,
	OPEN_DATE 
)
SELECT DISTINCT
    ACCOUNT_ID ,
	CUSTOMER_ID ,
	ACCOUNT_TYPE,
	OPEN_DATE 
    FROM  "FINANCE_DB"."PUBLIC"."FINANCE"

    
create or replace TABLE FINANCE_DB.PUBLIC.FACT_TRANSACTIONS (
	TRANSACTIONS_KEY int autoincrement primary key,
	CUSTOMER_KEY NUMBER,
	ACCOUNT_KEY NUMBER,
	TRANSACTION_DATE DATE,
	TRANSACTION_TYPE VARCHAR,
	AMOUNT NUMBER,
	CHANNEL VARCHAR,
	STATUS VARCHAR
);

 INSERT INTO FACT_TRANSACTIONS (
    CUSTOMER_KEY,
    ACCOUNT_KEY,
    TRANSACTION_DATE,
    TRANSACTION_TYPE,
    AMOUNT,
    CHANNEL,
    STATUS
) 
SELECT
    COALESCE(DC.CUSTOMER_KEY, -1) AS CUSTOMER_KEY,
    COALESCE(DA.ACCOUNT_KEY, -1)  AS ACCOUNT_KEY,
    F.TRANSACTION_DATE,
    F.TRANSACTION_TYPE,
    F.AMOUNT,
    F.CHANNEL,
    F.STATUS
 FROM FINANCE_DB.PUBLIC.TRANSACTIONS F
 LEFT JOIN DIM_FINANCE DA
    ON F.ACCOUNT_ID = DA.ACCOUNT_ID
LEFT JOIN DIM_CUSTOMERS DC
    ON F.TRANSACTION_ID = DC.CUSTOMER_ID

    select * from FACT_TRANSACTIONS
